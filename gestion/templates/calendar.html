{% load static %}
<!doctype html>
<html lang="en">

  
<!-- Mirrored from www.bootstrapget.com/demos/templatemonster/arise-admin-dashboard/calendar.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 12 Mar 2024 10:18:53 GMT -->
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Meta -->
    <meta name="description" content="Best MISUKLU">
    <meta name="author" content="Bootstrap Gallery" />
    <link rel="canonical" href="https://www.bootstrap.gallery/">
    <meta property="og:url" content="https://www.bootstrap.gallery/">
    <meta property="og:title" content="Admin Templates - Dashboard Templates | Bootstrap Gallery">
    <meta property="og:description" content="Marketplace for MISUKLU">
    <meta property="og:type" content="Website">
    <meta property="og:site_name" content="Bootstrap Gallery">
    <link rel="shortcut icon" href="{% static 'assets/images/favicon.svg' %}">

    <!-- Title -->
    <title>MISUKLU</title>


    <!-- *************
			************ Common Css Files *************
		************ -->

    <!-- Animated css -->
    <link rel="stylesheet" href="{% static 'assets/css/animate.css' %}">

    <!-- Bootstrap font icons css -->
    <link rel="stylesheet" href="{% static 'assets/fonts/bootstrap/bootstrap-icons.css' %}">

    <!-- Main css -->
    <link rel="stylesheet" href="{% static 'assets/css/main.min.css' %}">


    <!-- *************
			************ Vendor Css Files *************
		************ -->

    <!-- Scrollbar CSS -->
    <link rel="stylesheet" href="{% static 'assets/vendor/overlay-scroll/OverlayScrollbars.min.css' %}">

    <!-- Calendar CSS -->
    <link rel="stylesheet" href="{% static 'assets/vendor/calendar/css/main.min.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/vendor/calendar/css/custom.css' %}" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
  </head>

  <style>
    /* Masquer les heures de 12h à 13h30 */
    /* .fc-timegrid-slot-label[data-time="12:00:00"],
    .fc-timegrid-slot-label[data-time="12:30:00"],
    .fc-timegrid-slot-label[data-time="13:00:00"],
    .fc-timegrid-slot[data-time="12:00:00"],
    .fc-timegrid-slot[data-time="12:30:00"],
    .fc-timegrid-slot[data-time="13:00:00"],
    .fc-timegrid-slot[data-time="12:00:00"],
    .fc-timegrid-slot[data-time="12:30:00"],
    .fc-timegrid-slot[data-time="13:00:00"] {
      display: none;
    } */
    /* Masquer les heures après 16h30 */
    .fc-timegrid-slot-label[data-time="16:30:00"] ~ .fc-timegrid-slot,
    .fc-timegrid-slot-label[data-time="16:30:00"] {
      display: none;
    }
    /* Masquer la section All Day */
    .fc-daygrid-all-day {
      display: none;
    }
    .fc-daygrid-body .fc-daygrid-day-top {
      display: none;
    }
  </style>

  <body>

    <!-- Loading wrapper start -->
    <!-- <div id="loading-wrapper">
			<div class="spinner">
                <div class="line1"></div>
				<div class="line2"></div>
				<div class="line3"></div>
				<div class="line4"></div>
				<div class="line5"></div>
				<div class="line6"></div>
            </div>
		</div> -->
    <!-- Loading wrapper end -->

    <!-- Page wrapper start -->
    <div class="page-wrapper">

      <!-- Sidebar wrapper start -->
      <nav class="sidebar-wrapper">

        <!-- Sidebar brand starts -->
        <div class="sidebar-brand">
          <a href="{% url 'dashboards-directeur-des-etudes' %}" class="logo">
            <img src="{% static 'assets/images/logo.svg' %}" alt="Admin Dashboards" />
          </a>
        </div>
        <!-- Sidebar brand starts -->
  
        <!-- Sidebar menu starts -->
        <div class="sidebar-menu">
          <div class="sidebarMenuScroll">
            <ul>
                <li>
                    <center>
                        <ul>
                            <li>{{classe.nom_classe}}</li>
                            <li>{{classe.niveau_associée}}</li>
                        </ul>
                    </center>
                </li>
                <li>
                    <a href="{% url 'dashboards-directeur-des-etudes' %}">
                      <i class="bi bi-house"></i>
                      <span class="menu-text">Home</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'listclasse_etud' classe.id %}">
                      <i class="bi bi-stickies"></i>
                      <span class="menu-text">liste de classe</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'profmatiere' classe.id %}">
                      <i class="bi bi-stickies"></i>
                      <span class="menu-text">Prof et Matière</span>
                    </a>
                </li>
                <li class="sidebar-dropdown">
                    <a href="#">
                    <i class="bi bi-collection"></i>
                    <span class="menu-text">Notes</span>
                    </a>
                    <div class="sidebar-submenu">
                      <ul>
                        {% for matiere_classe in matiere_classes %}
                          <li>
                            <a href="">{{matiere_classe.matiere}}</a>
                          </li>
                        {% endfor %}
                      </ul>
                    </div>
                </li>
                <li class="sidebar-dropdown active">
                    <a href="#">
                    <i class="bi bi-calendar4"></i>
                    <span class="menu-text">Calendrier</span>
                    </a>
                    <div class="sidebar-submenu">
                    <ul>
                        <li>
                        <a href="{% url 'cons_calendrier' classe.id %}" class="current-page">Consulter le Calendrier</a>
                        </li>
                    </ul>
                    </div>
                </li>
            </ul>
          </div>
        </div>
        <!-- Sidebar menu ends -->
        <!-- Sidebar menu ends -->
  
    </nav>
      <!-- Sidebar wrapper end -->

      <!-- *************
				************ Main container start *************
			************* -->
      <div class="main-container">

        <!-- Page header starts -->
        <div class="page-header">

          <!-- Toggle sidebar start -->
          <div class="toggle-sidebar" id="toggle-sidebar"><i class="bi bi-list"></i></div>
          <!-- Toggle sidebar end -->
  
          <!-- Logo sm starts -->
      <a href="" class="d-lg-none d-md-block">
            <img src="{% static 'assets/images/logo.svg' %}" class="logo-sm" alt="Bootstrap Gallery">
        </a>
          <!-- Logo sm ends -->
  
          <!-- Breadcrumb start -->
          <ol class="breadcrumb d-lg-flex d-none">
            <li class="breadcrumb-item">
              <i class="bi bi-house"></i>
              <a href="">Home</a>
            </li>
          </ol>
          <!-- Breadcrumb end -->
  
          <!-- Header actions ccontainer start -->
          <div class="header-actions-container">
  
  

  
            <!-- Header actions start -->
            <ul class="header-actions">
              <li class="dropdown">
                <a href="#" id="userSettings" class="user-settings" data-toggle="dropdown" aria-haspopup="true">
                  <span class="user-name d-none d-md-block">{{user.first_name}}</span>
                  <span class="avatar">
                    <img src="{% static 'assets/images/user.png' %}" alt="Admin Templates">
                    <span class="status online"></span>
                  </span>
                </a>
                <div class="dropdown-menu dropdown-menu-end" aria-labelledby="userSettings">
                  <div class="header-profile-actions">
                    <a href="{% url 'settings' %}">Settings</a>
                    <a href="{% url 'logout' %}">Logout</a>
                  </div>
                </div>
              </li>
            </ul>
            <!-- Header actions end -->
  
          </div>
          <!-- Header actions ccontainer end -->
  
        </div>
        <!-- Page header ends -->

        <!-- Content wrapper scroll start -->
        <div class="content-wrapper-scroll">

          <!-- Content wrapper start -->
          <div class="content-wrapper">

            <!-- Row start -->
            <div class="row">
              <div class="col-xxl-12">

                <!-- Card start -->
                <div class="card">
                  <div class="card-body">

                    <div id="dayGrid" data-classe-id="{{ classe.id }}"></div>

                  </div>
                </div>
                <!-- Card end -->

              </div>
            </div>
            <!-- Row end -->

          </div>
          <!-- Content wrapper end -->

          <!-- App Footer start -->
          <div class="app-footer">
            <span>© Bootstrap Gallery 2024</span>
          </div>
          <!-- App footer end -->

        </div>
        <!-- Content wrapper scroll end -->

      </div>
      <!-- *************
				************ Main container end *************
			************* -->

    </div>
    <!-- Page wrapper end -->

    <!-- *************
			************ Required JavaScript Files *************
		************* -->
    <!-- Required jQuery first, then Bootstrap Bundle JS -->
    <script src="{% static 'assets/js/jquery.min.js' %}"></script>
    <script src="{% static 'assets/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/js/modernizr.js' %}"></script>
    <script src="{% static 'assets/js/moment.js' %}"></script>

    <!-- *************
			************ Vendor Js Files *************
		************* -->

    <!-- Overlay Scroll JS -->
    <script src="{% static 'assets/vendor/overlay-scroll/jquery.overlayScrollbars.min.js' %}"></script>
    <script src="{% static 'assets/vendor/overlay-scroll/custom-scrollbar.js' %}"></script>

    <!-- Calendar JS -->
    <script src="{% static 'assets/vendor/calendar/js/main.min.js' %}"></script>
    <script >
    document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('dayGrid');
    var classeId = calendarEl.getAttribute('data-classe-id');

    var calendar = new FullCalendar.Calendar(calendarEl, {
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'timeGridWeek'
        },
        events: 'all_events/{{classe.id}}',
        initialView: 'timeGridWeek',
        slotMinTime: '09:00:00',
        slotMaxTime: '17:00:00',
        initialDate: new Date(),
        selectable: true,
        navLinks: true,
        editable: true,
        dayMaxEvents: true,
        select: function (info) {
            var startDate = info.startStr.split('T')[0]; // Récupère uniquement la date

            swal("Nom de l'événement:", {
                content: "input",
            })
            .then((title) => {
                if (!title) throw null;

                return swal("Heure de début (HH:MM):", {
                    content: "input",
                })
                .then((startTime) => {
                    if (!startTime) throw null;

                    return swal("Heure de fin (HH:MM):", {
                        content: "input",
                    })
                    .then((endTime) => {
                        if (!endTime) throw null;

                        var start = `${startDate}T${startTime}:00`;
                        var end = `${startDate}T${endTime}:00`;

                        // Envoi des données à la vue Django pour l'ajout d'événement
                        fetch("/add_event/{{classe.id}}", {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCookie('csrftoken')
                            },
                            body: JSON.stringify({
                                title: title,
                                start: start,
                                end: end,
                            })
                        })
                        .then(response => {
                            if (response.ok) {
                                return response.json();
                            } else {
                                throw new Error('Error adding event');
                            }
                        })
                        .then(data => {
                            if (data.success) {
                                // Ajouter l'événement au calendrier si ajouté avec succès dans la base de données
                                calendar.addEvent(data);
                                calendar.refetchEvents(); // Rafraîchir les événements du calendrier
                            } else {
                                alert('Erreur lors de l\'ajout de l\'événement.');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    });
                });
            })
            .catch(err => {
                if (err) {
                    swal("Erreur", "Il y a eu une erreur lors de la création de l'événement", "error");
                } else {
                    swal.stopLoading();
                    swal.close();
                }
            });

            calendar.unselect();
        },
       eventClick: function (e) {
            var id = e.event.id;
            var eventTitle = e.event.title;
            if (id) {
                swal({
                    title: `Voulez-vous supprimer l'événement "${eventTitle}"?`,
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                })
                .then((willDelete) => {
                    if (willDelete) {
                        // Envoyer une requête POST à la vue Django pour supprimer l'événement
                        fetch('/remove/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCookie('csrftoken')
                            },
                            body: JSON.stringify({ id: id })
                        })
                        .then(response => {
                            if (response.ok) {
                                return response.json();
                            } else {
                                throw new Error('Error removing event');
                            }
                        })
                        .then(data => {
                            if (data.success) {
                                e.event.remove();
                                calendar.refetchEvents();
                                swal("Succès", "L'événement a été supprimé.", "success");
                            } else {
                                swal("Erreur", "Erreur lors de la suppression de l'événement.", "error");
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            swal("Erreur", "Il y a eu une erreur lors de la suppression de l'événement.", "error");
                        });
                    }
                });
            } else {
                console.error("Invalid event ID:", id);
            }
        }
    });

    calendar.render();

    // Fonction pour récupérer le jeton CSRF depuis les cookies
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});
</script>

    <!-- Main Js Required -->
    <script src="{% static 'assets/js/main.js' %}"></script>

  </body>


<!-- Mirrored from www.bootstrapget.com/demos/templatemonster/arise-admin-dashboard/calendar.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 12 Mar 2024 10:18:56 GMT -->
</html>